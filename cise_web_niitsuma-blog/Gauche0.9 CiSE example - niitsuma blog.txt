---
title: Gauche0.9 CiSE example
url: http://d.hatena.ne.jp/niitsuma/20081113/1281521109
---


   #[1]niitsuma blog [2]¥Ø¥ë¥× [3][scheme] give up run lalr-scm ...
   [4][scheme]stalingrad [5]RSS [6]RSS 2.0 [7]FOAF [8]niitsuma
   blogÆâÆüµ­¸¡º÷ [9]niitsuma blogÆâ°ìÍ÷¸¡º÷ [10]alternate

   IFRAME: [11]//www.googletagmanager.com/ns.html?id=GTM-58NPH6

   [12]Hatena:: [13]¥Ö¥í¥°(Diary)    __________________  Æüµ­  ¸¡º÷
   [14]¤Ï¤Æ¤Ê

        ¤è¤¦¤³¤½¥²¥¹¥È¤µ¤ó  [15]¥Ö¥í¥°¥È¥Ã¥× [16]µ»ö°ìÍ÷ [17]¥í¥°¥¤¥ó
   [18]ÌµÎÁ¥Ö¥í¥°³«Àß

          niitsuma blog [19]¤³¤Î¥Ú¡¼¥¸¤ò¥¢¥ó¥Æ¥Ê¤ËÄÉ²Ã [20]RSS¥Õ¥£¡¼¥É

   [21]<[scheme] give up run lalr-scm ... | [22][scheme]stalingrad>

[23]2008-11-13 [lisp]scheme

[24]¢£[[25]scheme]Gauche0.9 CiSE example

   CiSE usage

simple example cise

;save as cise-simple-example.scm

(define-cise-stmt (mywhen test . body)
  `(if ,test (begin ,@body)))

(define-cfn test1 (aa::int  ) ::void
  (mywhen (> aa  50 )  (test2))
)

(define-cfn test2 (argc::int argv::char**) ::int
  (dotimes [i (strlen (aref argv 0))] (printf "%02x" (aref (aref argv 0) i)))
)

(define-cfn main (argc::int argv::char**) ::int
  (dotimes [i (strlen (aref argv 0))] (printf "%02x" (aref (aref argv 0) i)))
)

;compile cise-simple-example.scm
(use gauche.cgen)
(use gauche.cgen.cise)

(call-with-output-file "cise-simple-example.c"
    (lambda (po)
      (cise-translate (open-input-file "cise-simple-example.scm ") po)))

   generated C code
#line 5 "cise-simple-example.scm"
 void test1(int aa){{
#line 6 "cise-simple-example.scm"
if ((aa)>(50)){{test2();}}}}
#line 9 "cise-simple-example.scm"
 int test2(int argc,char** argv){{
#line 10 "cise-simple-example.scm"
{int i=0;int cise__628=strlen((argv)[0]);for (; (i)<(cise__628); (i)++){printf("
%02x",((argv)[0])[i]);}}}}
#line 13 "cise-simple-example.scm"
 int main(int argc,char** argv){{
#line 14 "cise-simple-example.scm"
{int i=0;int cise__629=strlen((argv)[0]);for (; (i)<(cise__629); (i)++){printf("
%02x",((argv)[0])[i]);}}}}

simple example cise.stub

;save as stub-simple-example.scm
(declcode (.include <stdio.h>)
 "#ifndef M_PI
#define M_PI 3.1415926535897932384
#endif"
)

(define-cise-stmt (mywhen test . body)
  `(if ,test (begin ,@body)))

(define-cfn test1 (aa::int  ) ::void
  (mywhen (> aa  50 )  (test2))
)

(define-cfn test2 (argc::int argv::char**) ::int
  (dotimes [i (strlen (aref argv 0))] (printf "%02x" (aref (aref argv 0) i)))
)


;compile stub-simple-example.scm
(use gauche.parseopt)
(use gauche.parameter)
(use gauche.cgen)
(use gauche.cgen.stub)
(use file.util)
(use util.match)

(cgen-genstub "stub-simple-example.scm")


   generated C code
#include <gauche.h>

#line 2 "stub-simple-example.scm"
#include <stdio.h>

#ifndef M_PI
#define M_PI 3.1415926535897932384
#endif
 void test1(int aa){{
#line 12 "stub-simple-example.scm"
if ((aa)>(50)){{test2();}}}}
 int test2(int argc,char** argv){{
#line 16 "stub-simple-example.scm"
{int i=0;int cise__871=strlen((argv)[0]);for (; (i)<(cise__871); (i)++){printf("
%02x",((argv)[0])[i]);}}}}
void Scm_Init_stub_simple_example(ScmModule *mod){

}


more example cise.stub

;compile stub-simple-example.scm
;generate stub-simple-example.c and  stub-simple-example.h
(use gauche.parseopt)
(use gauche.parameter)
(use gauche.cgen)
(use gauche.cgen.stub)
(use file.util)
(use util.match)

(parameterize ([cgen-current-unit
                    (make <cgen-stub-unit>
                      :name "stub-simple-example"
                      :c-file  "stub-simple-example.c"
                      :h-file    "stub-simple-example.h"
                      :preamble '("/* Generated by my-genstub.  Do not edit. */"
)
                      :pre-decl '("#define AAAA 3.14")
                      :init-prologue "void test111(int aaaaa);\n"
                      )
                    ]
               )
              (with-input-from-file "stub-simple-example.scm"
                (cut port-fold
                     (lambda (form decl-strings?)
                       (cond [(and decl-strings? (string? form)) (cgen-decl form
) #t]
                             [else (cgen-stub-parse-form form) #f]))
                     #t read))

              (cgen-emit-c (cgen-current-unit))
              (cgen-emit-h (cgen-current-unit))
)

   generated code

   stub-simple-example.c
/* Generated by my-genstub.  Do not edit. */
#define AAAA 3.14
#include <gauche.h>

#line 2 "stub-simple-example.scm"
#include <stdio.h>

#ifndef M_PI
#define M_PI 3.1415926535897932384
#endif
 void test1(int aa){{
#line 12 "stub-simple-example.scm"
if ((aa)>(50)){{test2();}}}}
 int test2(int argc,char** argv){{
#line 16 "stub-simple-example.scm"
{int i=0;int cise__899=strlen((argv)[0]);for (; (i)<(cise__899); (i)++){printf("
%02x",((argv)[0])[i]);}}}}
void test1(int aa);

}

   stub-simple-example.h
/* Generated by my-genstub.  Do not edit. */

cgen code in [26]Gauche-0.9

   [27]Gauche-0.9/lib/[28]gauche/cgen.[29]scm

   [30]Gauche-0.9/lib/[31]gauche/cgen/*.[32]scm

example in [33]Gauche 0.9

   in [34]Gauche-0.9/[35]src/
     * builtin-syms.[36]scm

   usage
mkdir gauche
gosh builtin-syms.scm

   then generate builtin-syms.c [37]gauche/builtin-syms.c
     * geninsn

mkdir -p ../lib/gauche/vm/
mkdir gosh geninsn

   then generate vminsn.c [38]gauche/vminsn.h
   ../lib/[39]gauche/[40]vm/insn.[41]scm
     * vminsn.[42]scm
     * genstub and *.stub

´ØÏ¢link

     * ¡Ú[43]LLTV¥ì¥Ý¡¼¥È¡Û·àÅª¥Ó¥Õ¥©¡¼¥¢¥Õ¥¿¡¼¡¢¾¢¤Îµ»¡ÊÃæÊÔ¡Ë
       ¡ÈËÜÊª¤Î[44]¥Þ¥¯¥í¡É¤ÇC¤Î¥³¡¼¥É¹Ô¿ô¤òÈ¾Ê¬¤Ë¡ª
       [45]http://www.atmarkit.co.jp/news/200909/07/lltv02.html

     * [46]Gauche:[47]VM¤Î[48]ºÇÅ¬²½:VMLoop¤Î¼«Æ°À¸À®
       [49]http://practical-scheme.net/wiliki/wiliki.cgi?Gauche%3AVM%E3%81
       %AE%E6%9C%80%E9%81%A9%E5%8C%96%3AVMLoop%E3%81%AE%E8%87%AA%E5%8B%95%
       E7%94%9F%E6%88%90

     * dyncomp 0.1¥ê¥ê¡¼¥¹
       [50]http://d.hatena.ne.jp/koguro/20080622/1214134153

   [51]Permalink | [52]¥³¥á¥ó¥È(0) | [53]¥È¥é¥Ã¥¯¥Ð¥Ã¥¯(0) | 19:05
   [54]Gauche0.9 CiSE example¤ò´Þ¤à¥Ö¥Ã¥¯¥Þ¡¼¥¯ Gauche0.9 CiSE
   example¤Î¥Ö¥Ã¥¯¥Þ¡¼¥¯¥³¥á¥ó¥È
   [55]4781909345
   [56]Book GIMP/GNUPLOT/Tgif¤Ç³Ø¤Ö¥°¥é¥Õ¥£¥Ã¥¯½èÍý¡½UNIX...
   [57]¥µ¥¤¥¨¥ó¥¹¼Ò [58]³§ËÜ¹¸Ìï [59]ºä¾åµ®Ç·
   [60]4797311452
   [61]Book gnuplot¥Ñ¡¼¥Õ¥§¥¯¥È¡¦¥Þ¥Ë¥å¥¢¥ë (whatis UNIX...
   [62]¥½¥Õ¥È¥Ð¥ó¥¯¥¯¥ê¥¨¥¤¥Æ¥£¥Ö [63]Àî¸¶Ì
   ¥¯¥ê¥Ã¥¯: 11²ó
   ¥³¥á¥ó¥È¤ò½ñ¤¯

   _ _¥¹¥Ñ¥àÂÐºö¤Î¤¿¤á¤Î¥À¥ß¡¼¤Ç¤¹¡£¤â¤·¸«¤¨¤Æ¤â²¿¤âÆþÎÏ¤·¤Ê¤¤¤Ç¤¯¤À¤µ¤¤
   ¥²¥¹¥È _______________ [icon-usermail.gif] _______________
   [icon-userurl.gif] _______________

   ____________________________________________________________
   ____________________________________________________________
   ____________________________________________________________
   [captcha?1533730702] ²èÁüÇ§¾Ú
   __________
   Åê¹Æ
   ¥È¥é¥Ã¥¯¥Ð¥Ã¥¯ - http://d.hatena.ne.jp/niitsuma/20081113/1281521109
   id¥È¥é¥Ã¥¯¥Ð¥Ã¥¯
     * [64]niitsuma¤ÎÆüµ - link½¸

   ¥ê¥ó¥¯¸µ
     * 263
       [65]http://www.google.co.jp/search?hl=ja&client=firefox-a&rls=org.m
       ozilla:ja:official&hs=JdI&q=boost+python+numeric&btnG=¸¡º÷&lr=lang_
       ja
     * 156
       [66]http://www.google.co.jp/search?hl=ja&lr=lang_ja&client=firefox-
       a&rls=org.mozilla:ja:official&hs=UeT&q=cmake+»È¤¤Êý&revid=678869898
       &sa=X&oi=revisions_inline&resnum=1&ct=broad-revision&cd=1
     * 100
       [67]http://www.google.co.jp/search?sourceid=navclient&hl=ja&ie=UTF-
       8&rlz=1T4SUNA_jaJP249JP249&q=centos+gtag+install
     * 93
       [68]http://www.google.co.jp/search?hl=ja&client=firefox-a&rls=com.u
       buntu:ja:unofficial&hs=bDe&q=emacs+C++&btnG=¸¡º÷&lr=lang_ja
     * 63
       [69]http://www.google.co.jp/search?q=cmake+»È¤¤Êý&lr=lang_ja&ie=utf
       -8&oe=utf-8&aq=t&rls=org.mozilla:ja:official&client=firefox-a
     * 53 [70]http://www2s.biglobe.ne.jp/~niitsuma/
     * 49
       [71]http://www.google.com/search?hl=ja&lr=lang_ja&ie=UTF-8&oe=UTF-8
       &q=yum+¥À¥¦¥ó¥°¥ì¡¼¥É+ÊýË¡&safe=off&num=100
     * 45 [72]http://d.hatena.ne.jp/
     * 43
       [73]http://www.google.co.jp/search?hl=ja&safe=off&client=firefox-a&
       rls=org.mozilla:en-US:official&hs=oa&q=ctype+python&btnG=¸¡º÷&lr=
     * 41
       [74]http://www.google.co.jp/search?hl=ja&q=cmake+»È¤¤Êý&lr=&aq=1&oq
       =cmake+

   [75]<[scheme] give up run lalr-scm ... | [76][scheme]stalingrad>
   ¥«¥Æ¥´¥ê¡¼
     * [77]emacs
     * [78]cmake
     * [79]boost
     * [80]c++
     * [81]linux
     * [82]debian
     * [83]python
     * [84]ubuntu
     * [85]image processing
     * [86]lisp
     * [87]centos
     * [88]etc
     * [89]¥Í¥¿
     * [90]windows
     * [91]R
     * [92]c
     * [93]maxima
     * [94]eamcs
     * [95]schme
     * [96]scheme
     * [97]SICP
     * [98]iphone
     * [99]gentoo
     * [100]Java

   [101]¤¢¤ï¤»¤ÆÆÉ¤ß¤¿¤¤¥Ö¥í¥°¥Ñ¡¼¥Ä

References

   Visible links:
   1. file:///
   2. file:///help
   3. file:///niitsuma/20081113/1317186899
   4. file:///niitsuma/20081113/1274263975
   5. http://d.hatena.ne.jp/niitsuma/rss
   6. http://d.hatena.ne.jp/niitsuma/rss2
   7. http://d.hatena.ne.jp/niitsuma/foaf
   8. http://d.hatena.ne.jp/niitsuma/opensearch/diary.xml
   9. http://d.hatena.ne.jp/niitsuma/opensearch/archive.xml
  10. http://d.hatena.ne.jp/niitsuma/mobile?date=20081113&section=1281521109
  11. file://www.googletagmanager.com/ns.html?id=GTM-58NPH6
  12. http://www.hatena.ne.jp/
  13. http://d.hatena.ne.jp/
  14. http://www.hatena.ne.jp/
  15. http://d.hatena.ne.jp/niitsuma/
  16. http://d.hatena.ne.jp/niitsuma/archive
  17. https://www.hatena.ne.jp/login?backurl=http%3A%2F%2Fd.hatena.ne.jp%2Fniitsuma%2F20081113%2F1281521109&add_timestamp=1
  18. https://www.hatena.ne.jp/register?location=http%3A%2F%2Fd.hatena.ne.jp%3Fvia%3D200186&via=200186
  19. http://a.hatena.ne.jp/append?http://d.hatena.ne.jp/niitsuma/
  20. http://d.hatena.ne.jp/niitsuma/rss
  21. file:///niitsuma/20081113/1317186899
  22. file:///niitsuma/20081113/1274263975
  23. http://d.hatena.ne.jp/niitsuma/20081113
  24. file:///niitsuma/20081113/1281521109
  25. file:///niitsuma/searchdiary?word=%2A%5Bscheme%5D
  26. http://d.hatena.ne.jp/keyword/Gauche
  27. http://d.hatena.ne.jp/keyword/Gauche
  28. http://d.hatena.ne.jp/keyword/gauche
  29. http://d.hatena.ne.jp/keyword/scm
  30. http://d.hatena.ne.jp/keyword/Gauche
  31. http://d.hatena.ne.jp/keyword/gauche
  32. http://d.hatena.ne.jp/keyword/scm
  33. http://d.hatena.ne.jp/keyword/Gauche
  34. http://d.hatena.ne.jp/keyword/Gauche
  35. http://d.hatena.ne.jp/keyword/src
  36. http://d.hatena.ne.jp/keyword/scm
  37. http://d.hatena.ne.jp/keyword/gauche
  38. http://d.hatena.ne.jp/keyword/gauche
  39. http://d.hatena.ne.jp/keyword/gauche
  40. http://d.hatena.ne.jp/keyword/vm
  41. http://d.hatena.ne.jp/keyword/scm
  42. http://d.hatena.ne.jp/keyword/scm
  43. http://d.hatena.ne.jp/keyword/LLTV
  44. http://d.hatena.ne.jp/keyword/%A5%DE%A5%AF%A5%ED
  45. http://www.atmarkit.co.jp/news/200909/07/lltv02.html
  46. http://d.hatena.ne.jp/keyword/Gauche
  47. http://d.hatena.ne.jp/keyword/VM
  48. http://d.hatena.ne.jp/keyword/%BA%C7%C5%AC%B2%BD
  49. http://practical-scheme.net/wiliki/wiliki.cgi?Gauche%3AVM%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%3AVMLoop%E3%81%AE%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90
  50. http://d.hatena.ne.jp/koguro/20080622/1214134153
  51. file:///niitsuma/20081113/1281521109
  52. file:///niitsuma/20081113/1281521109#c
  53. file:///niitsuma/20081113/1281521109#tb
  54. http://b.hatena.ne.jp/entry/http://d.hatena.ne.jp/niitsuma/20081113/1281521109
  55. http://d.hatena.ne.jp/asin/4781909345
  56. http://d.hatena.ne.jp/asin/4781909345
  57. http://d.hatena.ne.jp/keyword/%A5%B5%A5%A4%A5%A8%A5%F3%A5%B9%BC%D2
  58. http://d.hatena.ne.jp/keyword/%B3%A7%CB%DC%B9%B8%CC%EF
  59. http://d.hatena.ne.jp/keyword/%BA%E4%BE%E5%B5%AE%C7%B7
  60. http://d.hatena.ne.jp/asin/4797311452
  61. http://d.hatena.ne.jp/asin/4797311452
  62. http://d.hatena.ne.jp/keyword/%A5%BD%A5%D5%A5%C8%A5%D0%A5%F3%A5%AF%A5%AF%A5%EA%A5%A8%A5%A4%A5%C6%A5%A3%A5%D6
  63. http://d.hatena.ne.jp/keyword/%C0%EE%B8%B6%CC%AD
  64. http://d.hatena.ne.jp/niitsuma/20080125/1228194822
  65. http://www.google.co.jp/search?hl=ja&client=firefox-a&rls=org.mozilla%3Aja%3Aofficial&hs=JdI&q=boost+python+numeric&btnG=%E6%A4%9C%E7%B4%A2&lr=lang_ja
  66. http://www.google.co.jp/search?hl=ja&lr=lang_ja&client=firefox-a&rls=org.mozilla:ja:official&hs=UeT&q=cmake+%E4%BD%BF%E3%81%84%E6%96%B9&revid=678869898&sa=X&oi=revisions_inline&resnum=1&ct=broad-revision&cd=1
  67. http://www.google.co.jp/search?sourceid=navclient&hl=ja&ie=UTF-8&rlz=1T4SUNA_jaJP249JP249&q=centos+gtag+install
  68. http://www.google.co.jp/search?hl=ja&client=firefox-a&rls=com.ubuntu%3Aja%3Aunofficial&hs=bDe&q=emacs+C%2B%2B&btnG=%E6%A4%9C%E7%B4%A2&lr=lang_ja
  69. http://www.google.co.jp/search?q=cmake+%E4%BD%BF%E3%81%84%E6%96%B9&lr=lang_ja&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:ja:official&client=firefox-a
  70. http://www2s.biglobe.ne.jp/~niitsuma/
  71. http://www.google.com/search?hl=ja&lr=lang_ja&ie=UTF-8&oe=UTF-8&q=yum+%E3%83%80%E3%82%A6%E3%83%B3%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89+%E6%96%B9%E6%B3%95&safe=off&num=100
  72. http://d.hatena.ne.jp/
  73. http://www.google.co.jp/search?hl=ja&safe=off&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=oa&q=ctype+python&btnG=%E6%A4%9C%E7%B4%A2&lr=
  74. http://www.google.co.jp/search?hl=ja&q=cmake+%E4%BD%BF%E3%81%84%E6%96%B9&lr=&aq=1&oq=cmake+
  75. file:///niitsuma/20081113/1317186899
  76. file:///niitsuma/20081113/1274263975
  77. file:///niitsuma/searchdiary?word=%2A%5Bemacs%5D
  78. file:///niitsuma/searchdiary?word=%2A%5Bcmake%5D
  79. file:///niitsuma/searchdiary?word=%2A%5Bboost%5D
  80. file:///niitsuma/searchdiary?word=%2A%5Bc%2B%2B%5D
  81. file:///niitsuma/searchdiary?word=%2A%5Blinux%5D
  82. file:///niitsuma/searchdiary?word=%2A%5Bdebian%5D
  83. file:///niitsuma/searchdiary?word=%2A%5Bpython%5D
  84. file:///niitsuma/searchdiary?word=%2A%5Bubuntu%5D
  85. file:///niitsuma/searchdiary?word=%2A%5Bimage%20processing%5D
  86. file:///niitsuma/searchdiary?word=%2A%5Blisp%5D
  87. file:///niitsuma/searchdiary?word=%2A%5Bcentos%5D
  88. file:///niitsuma/searchdiary?word=%2A%5Betc%5D
  89. file:///niitsuma/searchdiary?word=%2A%5B%A5%CD%A5%BF%5D
  90. file:///niitsuma/searchdiary?word=%2A%5Bwindows%5D
  91. file:///niitsuma/searchdiary?word=%2A%5BR%5D
  92. file:///niitsuma/searchdiary?word=%2A%5Bc%5D
  93. file:///niitsuma/searchdiary?word=%2A%5Bmaxima%5D
  94. file:///niitsuma/searchdiary?word=%2A%5Beamcs%5D
  95. file:///niitsuma/searchdiary?word=%2A%5Bschme%5D
  96. file:///niitsuma/searchdiary?word=%2A%5Bscheme%5D
  97. file:///niitsuma/searchdiary?word=%2A%5BSICP%5D
  98. file:///niitsuma/searchdiary?word=%2A%5Biphone%5D
  99. file:///niitsuma/searchdiary?word=%2A%5Bgentoo%5D
 100. file:///niitsuma/searchdiary?word=%2A%5BJava%5D
 101. http://awasete.com/show.phtml?u=http%3A%2F%2Fd.hatena.ne.jp%2Fniitsuma%2F

   Hidden links:
 103. http://b.hatena.ne.jp/entry/http://d.hatena.ne.jp/niitsuma/20081113/1281521109
